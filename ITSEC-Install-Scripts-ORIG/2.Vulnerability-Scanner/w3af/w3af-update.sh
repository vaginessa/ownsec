#!/bin/bash

#1i
. /opt/ownsec/ITSEC-Install-Scripts-ORIG/001.functions/all-scripts.sh

GITREPO=https://github.com/andresriancho/w3af.git
BRANCH=master
GITREPOROOT=/opt/ITSEC/2.Vulnerability-Scanner/w3af/andresriancho/w3af
GITCONFDIR=/opt/ITSEC/2.Vulnerability-Scanner/w3af/andresriancho/w3af/.git
GITCLONEDIR=/opt/ITSEC/2.Vulnerability-Scanner/w3af/andresriancho
EXECUTEABLE1=w3af_console
EXECUTEABLE1GUI=w3af_gui
EXECUTEABLE1SH=w3af_console.sh
EXECUTEABLE1GUISH=w3af_gui.sh
#ph1b
DSKTPFLS=/opt/ownsec/ITSEC-Install-Scripts-ORIG/3.Exploitation-Tools/5.SE_Phishing/w3af
DSKTPFLSDEST=/home/$USER/.local/share/applications/3.Exploitation-Tools/5.SE_Phishing/w3af
DSKTPFL=beef.desktop
APTLSTDIR=/opt/ownsec/ITSEC-Install-Scripts-ORIG/0.Initial/lst/apt
#ph1a

echo "${bold}
__        _______   _    _____ 
\ \      / /___ /  / \  |  ___|
 \ \ /\ / /  |_ \ / _ \ | |_   
  \ V  V /  ___) / ___ \|  _|  
   \_/\_/  |____/_/   \_\_|    
           
UPDATE
${normal}"

GITUPTODATE
if git checkout $BRANCH &&
git fetch origin $BRANCH &&
[ `git rev-list HEAD...origin/$BRANCH --count` != 0 ] &&
git merge origin/$BRANCH
then
    
GITCLONEFUNC

GITRESET
GITSBMDLINIT

# Lets do this with virtualenv ....

# write an install script for the venv routine and run it for each
echo '#!/bin/bash

cd /opt/ITSEC/2.Vulnerability-Scanner/w3af/andresriancho/w3af

virtualenv venv
. venv/bin/activate
./w3af_console
. /tmp/user/1000/w3af_dependency_install.sh' > installvenv_w3af_console.sh

chmod +x installvenv_w3af_console.sh
./installvenv_w3af_console.sh


echo '#!/bin/bash

cd /opt/ITSEC/2.Vulnerability-Scanner/w3af/andresriancho/w3af

virtualenv --system-site-packages venv
. venv/bin/activate
./w3af_gui
#. /tmp/user/1000/w3af_dependency_install.sh
. /tmp/w3af_dependency_install.sh' > installvenv_w3af_gui.sh

chmod +x installvenv_w3af_gui.sh
./installvenv_w3af_gui.sh



#cp /opt/ownsec/ITSEC-Install-Scripts-ORIG/2.Vulnerability-Scanner/w3af-files/requirements.py /opt/ITSEC/2.Vulnerability-Scanner/w3af/andresriancho/w3af/w3af/core/controllers/dependency_check/requirements.py

echo '#!/bin/bash

cd /opt/ITSEC/2.Vulnerability-Scanner/w3af/andresriancho/w3af

. venv/bin/activate
./w3af_console "$@"' > $EXECUTEABLE1SH

chmod +x $EXECUTEABLE1SH

echo '#!/bin/bash

cd /opt/ITSEC/2.Vulnerability-Scanner/w3af/andresriancho/w3af

. venv/bin/activate 
./w3af_gui "$@"' > $EXECUTEABLE1GUISH

chmod +x $EXECUTEABLE1GUISH


GUI

sudo ln -s $GITREPOROOT/$EXECUTEABLE1SH $BINDIR/$EXECUTEABLE1
sudo ln -s $GITREPOROOT/$EXECUTEABLE1GUISH $BINDIR/$EXECUTEABLE1GUI
#cd /opt/ITSEC/7.Mitm/7.Mitm/mitmproxy python-git python3-git
#sudo apt-get purge --remove python-enum34
#sudo -H pip2 install enum34 twisted

rm -f  $DSKTPFLSDEST/$DSKTPFL
#333d
CPDESKTFL

echo "${bold}
UPDATED
${normal}"

else

echo "${bold}
UP TO DATE
${normal}"
	
fi
