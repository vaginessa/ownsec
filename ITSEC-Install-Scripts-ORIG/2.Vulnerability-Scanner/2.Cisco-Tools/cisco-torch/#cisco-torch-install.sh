#!/bin/bash

#doesent work
#https://stackoverflow.com/questions/5939696/installing-net-ssh-perl-pm

bold=$(tput bold)
normal=$(tput sgr0)

GITREPO=https://github.com/foreni-packages/cisco-torch.git
BRANCH=master
GITREPOROOT=/opt/ITSEC/2.Vulnerability-Scanner/2.Cisco-Tools/cisco-torch/foreni-packages/cisco-torch
GITCLONEDIR=/opt/ITSEC/2.Vulnerability-Scanner/2.Cisco-Tools/cisco-torch/foreni-packages
EXECUTEABLE1=cisco-torch.pl
EXECUTEABLE2=ciscoTORCH
BINDIR=/usr/local/bin
DSKTPFLS=/opt/ownsec/ITSEC-Install-Scripts-ORIG/2.Vulnerability-Scanner/2.Cisco-Tools/cisco-global-exploiter/cisco-torch
DSKTPFLSDEST=/home/$USER/.local/share/applications/2.Vulnerability-Scanner/2.Cisco-Tools/cisco-global-exploiter/cisco-torch
DSKTPFL=cisco-torch.desktop
APTLSTDIR=/opt/ownsec/ITSEC-Install-Scripts-ORIG/0.Initial/lst/apt
GITSBMDLINIT () {
	git submodule init
	git submodule update --recursive
	sudo updatedb && sudo ldconfig
}

echo "${bold}
  ____ ___ ____   ____ ___    _____ ___  ____   ____ _   _ 
 / ___|_ _/ ___| / ___/ _ \  |_   _/ _ \|  _ \ / ___| | | |
| |    | |\___ \| |  | | | |   | || | | | |_) | |   | |_| |
| |___ | | ___) | |__| |_| |   | || |_| |  _ <| |___|  _  |
 \____|___|____/ \____\___/    |_| \___/|_| \_\\____|_| |_|
          
INSTALL
${normal}"

mkdir -p $GITCLONEDIR
cd $GITCLONEDIR
git clone $GITREPO
cd $GITREPOROOT

### DEPS:

sudo apt-get update
sudo apt-get upgrade
xargs -a <(awk '/^\s*[^#]/' "$APTLSTDIR/deps-cisco-torch.txt") -r -- sudo apt-get install -y
### DEPS END

GITSBMDLINIT

#echo '#!/bin/bash
#cd /opt/ITSEC/2.Vulnerability-Scanner/2.Cisco-Tools/cisco-auditing-tool/foreni-packages/cisco-auditing-tool
#./cisco-torch.pl "$@"' >> $EXECUTEABLE2
chmod +x $GITREPOROOT/$EXECUTEABLE1
#chmod +x $GITREPOROOT/$EXECUTEABLE2
sudo rm -f $BINDIR/$EXECUTEABLE2
sudo ln -s $GITREPOROOT/$EXECUTEABLE1 $BINDIR/$EXECUTEABLE2

