#!/bin/bash

bold=$(tput bold)
normal=$(tput sgr0)

GITREPO=https://github.com/rastating/wordpress-exploit-framework
BRANCH=master
GITREPOROOT=/opt/ITSEC/2.Vulnerability-Scanner/wordpress-exploit-framework/rastating/wordpress-exploit-framework
GITREPOBINDIR=/opt/ITSEC/2.Vulnerability-Scanner/wordpress-exploit-framework/rastating/wordpress-exploit-framework/bin
GITCLONEDIR=/opt/ITSEC/2.Vulnerability-Scanner/wordpress-exploit-framework/rastating
EXECUTEABLE1=wpxf.sh 
EXECUTEABLE2=wordpress-exploit-framework
BINDIR=/usr/local/bin
DSKTPFLS=/opt/ITSEC-Install-Scripts/0.Initial/usrlcl/.local/share/applications/2.Vulnerability-Scanner
DSKTPFLSDEST=/home/$USER/.local/share/applications/2.Vulnerability-Scanner
DSKTPFL=wordpress-exploit-framework.desktop
APTLSTDIR=/opt/ITSEC-Install-Scripts/0.Initial/lst/apt
GITSBMDLINIT () {
	git submodule init
	git submodule update --recursive
	sudo updatedb && sudo ldconfig
}

echo "${bold}
__        ______       _______  __     _____ __  ____        ______  _  __
\ \      / /  _ \     | ____\ \/ /    |  ___|  \/  \ \      / /  _ \| |/ /
 \ \ /\ / /| |_) |____|  _|  \  /_____| |_  | |\/| |\ \ /\ / /| |_) | ' / 
  \ V  V / |  __/_____| |___ /  \_____|  _| | |  | | \ V  V / |  _ <| . \ 
   \_/\_/  |_|        |_____/_/\_\    |_|   |_|  |_|  \_/\_/  |_| \_\_|\_\
                                                                                         
INSTALL                                   
${normal}"

mkdir -p $GITCLONEDIR
cd $GITCLONEDIR
git clone -b $BRANCH $GITREPO
cd $GITREPOROOT

### DEPS:
sudo apt-get install build-essential patch
sudo apt-get install ruby-dev zlib1g-dev liblzma-dev
sudo ldconfig
sudo updatedb

. ~/.bashrc
eval "$(rbenv init -)"
yes "N" | rbenv install 2.4.1 
rbenv rehash
sudo updatedb
sudo ldconfig
rbenv shell 2.4.1 
### DEPS END

APTLSTDIR=/opt/ITSEC-Install-Scripts/0.Initial/lst/apt
GITSBMDLINIT

gem install bundler
bundle update
bundle install
#gem uninstall arachni
#gem install arachni
#gem install rake
#cd $GITREPOBINDIR

echo '#!/bin/bash 

cd /opt/ITSEC/2.Vulnerability-Scanner/wordpress-exploit-framework/rastating/wordpress-exploit-framework

source ~/.bashrc
eval "$(rbenv init -)"
rbenv shell 2.4.1
ruby wpxf.rb "$@"
' > $EXECUTEABLE1

chmod +x $GITREPOROOT/$EXECUTEABLE1
sudo rm -f $BINDIR/$EXECUTEABLE2
sudo ln -s $GITREPOROOT/$EXECUTEABLE1 $BINDIR/$EXECUTEABLE2

mkdir -p $DSKTPFLSDEST
cp $DSKTPFLS/$DSKTPFL $DSKTPFLSDEST/$DSKTPFL



